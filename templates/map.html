<!DOCTYPE html>
<html>
  <head>
    {% load static %}
    {% include "header.html" %}
    <script type="text/javascript" src="https://unpkg.com/default-passive-events"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <link rel="stylesheet" type="text/css" href="../static/css/map.css"/>
  </head>
  <body>
    <div class = "home-label">
      <a href="/">
        <img title = "return home" src="{%static 'images/home-icon.svg' %}">
      </a>
    </div>
    <div id="map"></div>
    <script src="{% url 'gMap' %}" defer></script>
    <script>
      let map;
      let circle;
      let infoWindow;

      function initMap() {
        // The location of Chico
        const position = { lat: 39.7285, lng: -121.8375 };

        // The map, centered at Chico
        map = new google.maps.Map(document.getElementById("map"), {
          zoom: 14,
          center: position,
          mapTypeControl: true,
          fullscreenControl: false,
          streetViewControl: false,
          mapTypeControlOptions: {
            style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR,
            position: google.maps.ControlPosition.TOP_RIGHT
          }
        });

        var user_first_name = "{{ firstname }}"
        
        // Create an info window with the tooltip content
        infoWindow = new google.maps.InfoWindow({
          content: user_first_name + " is somewhere here",
        });

        // Create a circle with a radius of 100 meters
        circle = new google.maps.Circle({
          map: map,
          center: position,
          radius: 100, // in meters
          fillColor: "#007bff", // fill color of the circle
          fillOpacity: 0.2,    // opacity of the fill
          strokeColor: "#007bff", // border color
          strokeOpacity: 0.8,      // opacity of the border
          clickable: true,
          strokeWeight: 2,     // border thickness
        });
        
        google.maps.event.addListener(circle, 'click', function(ev){
            infoWindow.setPosition(ev.latLng);
            infoWindow.open(map);
        });
       
        var friendNames = "{{ friends_first_name }}";
        var friendLats = "{{ friends_lat }}";
        var friendsLong = "{{ friends_long }}"

        for(var i=0; i<friendNames.length; i++) {
          // Create a circle with a radius of 100 meters

          friend_pos = { lat: friendsLats[i], lng: friendsLong[i]};

          friend_circle = new google.maps.Circle({
            map: map,
            center: friend_pos,
            radius: 100, // in meters
            fillColor: "#007bff", // fill color of the circle
            fillOpacity: 0.2,    // opacity of the fill
            strokeColor: "#007bff", // border color
            strokeOpacity: 0.8,      // opacity of the border
            clickable: true,
            strokeWeight: 2,     // border thickness
          });
        }
        // Add a mouseover event listener to the circle to display the tooltip
      }

      window.initMap = initMap;
    </script>
  </body>
</html>